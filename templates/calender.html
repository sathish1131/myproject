{% extends 'background.html' %}
{% load static %}

{% block title %}Calender{% endblock %}
{% block page_title %}Calender{% endblock %}

{% block content %}

<div class="calender-header">
    <div>
        <label for="month">Month</label>
        <select class="calender-dropdown" name="month" id="month">
            {% for month in months %}
            <option value="{{ forloop.counter }}" {% if forloop.counter == current_month  %}selected{% endif %}>{{ month }}</option>
            {% endfor %}
        </select>
    </div>
    <div>
        <label for="year">Year</label>
        <select class="calender-dropdown" name="year" id="year">
            {% for year in years %}
            <option value="{{ year }}" {% if year == current_year  %}selected{% endif %}>{{ year }}</option>
            {% endfor %}
        </select>
    </div>
    <div>
        <label for="decade">Decade</label>
        <select class="calender-dropdown" name="decade" id="decade">
            {% for decade in decades %}
            <option value="{{ decade }}" {% if decade == current_decade  %}selected{% endif %}>{{ decade }}</option>
            {% endfor %}
        </select>
    </div>
</div>
<div class="app-content">
    <div class="calender-layout">
        {{ calender|safe }}
    </div>
    <div class="event-layout">
        <div style="justify-content: right; text-align:right; padding: 10px 20px;">
            <button type="button" class="add-button" data-bs-toggle="modal" data-bs-target="#addEventModal">Add Event</button>
        </div>
        <table id="event-table" class="event-table">
            <thead>
                <tr>
                    <th>Event Time</th>
                    <th>Event Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for event in events %}
                <tr id="row-{{ task.id }}" style="background-color: #d3d3d3;">
                    <td>
                        <p>{{ event.time }}</p>
                    </td>
                    <td>
                        <p>{{ event.description }}</p>
                    </td>
                    <td style="display:flex; align-items:center;">
                        <a href="#" class="btn btn-link" style="margin-right:10px;text-align:center;"
                            data-task-id="{{ event.id }}" id="edit-btn">
                            <i class="fas fa-edit" data-bs-toggle="modal" data-bs-target="#editTaskModal"></i>
                        </a>
                        <a href="#" class="btn btn-link ml-2" id="delete-btn" style="margin-right:10px;text-align:center;"
                            data-task-id="{{ event.id }}">
                            <i class="fas fa-trash" data-bs-toggle="modal" data-bs-target="#deleteTaskModal"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<script src="{% static 'jquery-3.7.1.min.js' %}"></script>
<script>

    $(document).ready(function(){
        let dateBoxes = document.querySelectorAll('td');
        dateBoxes.forEach(dateBox => {
            if(dateBox.textContent.trim() == '{{ current_day }}'){
                dateBox.style.backgroundColor = '#32CD32';
            }
        });

        $('#month').on('change', function(){
            let selectedMonth = $(this).val();
            let selectedYear = $('#year').val();
            $.ajax({
                type: 'GET',
                url: '{% url "fetch_calender" %}',
                data: {
                    month: selectedMonth,
                    year: selectedYear
                },
                success: function(response){
                    $('.calender-layout').html(response.calender);
                },
                error: function(error){
                    alert(error);
                }
            })
        });

        $('#year').on('change', function(){
            let selectedYear = $(this).val();
            let selectedMonth = $('#month').val();
            $.ajax({
                type: 'GET',
                url: '{% url "fetch_calender" %}',
                data: {
                    month: selectedMonth,
                    year: selectedYear
                },
                success: function(response){
                    $('.calender-layout').html(response.calender);
                },
                error: function(error){
                    alert(error);
                }
            })
        });

        $('#decade').on('change', function(){
            let selectedDecade = $(this).val();
            let yearDropdown = document.getElementById('year');
            $.ajax({
                type: 'GET',
                url: '{% url "fetch_years" %}',
                data: {'selected_decade': selectedDecade},
                success: function(response){
                    yearDropdown.innerHTML = '';
                    response.years.forEach(year => {
                        const option = document.createElement('option');
                        option.value = year
                        option.textContent = year
                        yearDropdown.appendChild(option);
                    });
                },
                error: function(error){
                    alert(error);
                }
            });
        });

    });
</script>

{% endblock %}